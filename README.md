## üá¨üáß  [English version](README_EN.md)

# FileFinder

–ú–æ—â–Ω–∞—è –∫—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–∞—è CLI-—É—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ —Ñ–∞–π–ª–∞–º –∏ –∞—Ä—Ö–∏–≤–∞–º. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç plain/regex –ø–∞—Ç—Ç–µ—Ä–Ω—ã,
whitelist/blacklist —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≥–ª—É–±–∏–Ω—ã, fail-fast, –ø–æ—Ç–æ–∫–æ–≤—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–ª–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –ø—Ä–∏
—Å–æ–≤–ø–∞–¥–µ–Ω–∏–∏.

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

1. –°–±–æ—Ä–∫–∞

```bash
go build -o filefinder ./cmd/main.go
```

2. –ü–∞—Ç—Ç–µ—Ä–Ω—ã - —Å–æ–∑–¥–∞–π—Ç–µ `patterns.txt`

```
re:\bsecret\b
plain:password
plain:i:Token
```

3. –ó–∞–ø—É—Å–∫

```bash
./filefinder \
  --pattern-file patterns.txt \
  --whitelist txt,log \
  --archives \
  --threads 8 \
  /var/log
```

---

## üî• –ß—Ç–æ –≤–Ω—É—Ç—Ä–∏

* –ü–æ–∏—Å–∫ –ø–æ –≤—Å–µ–º –¥–∏—Å–∫–∞–º –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã–º —Ç–æ–º–∞–º - –∞–≤—Ç–æ–¥–µ—Ç–µ–∫—Ç root –¥–ª—è Windows/Linux/macOS
* –ê—Ä—Ö–∏–≤—ã: zip, tar, gz, bz2, xz, rar, 7z, zst –∏ –¥—Ä.
* –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π: whitelist –∏ blacklist
* –ì–ª—É–±–∏–Ω–∞ –æ–±—Ö–æ–¥–∞ `--depth N` - —Ä–µ–∂–µ—Ç –¥–µ—Ä–µ–≤–æ —Ä–∞–Ω–æ, —ç–∫–æ–Ω–æ–º–∏—Ç –≤—Ä–µ–º—è
* Fail-fast `--fail-fast` - –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ –ø–µ—Ä–≤–æ–π –æ—à–∏–±–∫–µ
* –ü–æ—Ç–æ–∫–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ - –¥–µ—Å—è—Ç–∫–∏-—Å–æ—Ç–Ω–∏ –≤–æ—Ä–∫–µ—Ä–æ–≤
* –ê–Ω—Ç–∏ zip-–±–æ–º–±–∞ - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ñ–∞–π–ª–æ–≤ –≤ –∞—Ä—Ö–∏–≤–µ
* –ü–æ–Ω—è—Ç–Ω—ã–µ –ª–æ–≥–∏ –∏ —Ñ–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
* –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–ª–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏–∏ –±–µ–∑ –∑–∞–≥—Ä—É–∑–∫–∏ –≤ –ø–∞–º—è—Ç—å - —á–µ—Ä–µ–∑ temp+rename

---

## üõ†Ô∏è –ê—Ä–≥—É–º–µ–Ω—Ç—ã

| –§–ª–∞–≥                    | –û–ø–∏—Å–∞–Ω–∏–µ                                                   | –ü—Ä–∏–º–µ—Ä                               |
|-------------------------|------------------------------------------------------------|--------------------------------------|
| `--pattern-file`        | –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É —Å –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º–∏ - –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω                     | `--pattern-file patterns.txt`        |
| `--whitelist`           | –¢–æ–ª—å–∫–æ —ç—Ç–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è - –±–µ–∑ —Ç–æ—á–∫–∏, —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é           | `--whitelist txt,log,json`           |
| `--blacklist`           | –ò—Å–∫–ª—é—á–∏—Ç—å —ç—Ç–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è                                   | `--blacklist jpg,png`                |
| `--archives`            | –í–∫–ª—é—á–∏—Ç—å —Å–∫–∞–Ω –∞—Ä—Ö–∏–≤–æ–≤                                      | `--archives`                         |
| `--depth`               | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≥–ª—É–±–∏–Ω–∞ (0 - –±–µ–∑–ª–∏–º–∏—Ç)                        | `--depth 3`                          |
| `--threads`             | –ö–æ–ª-–≤–æ –≤–æ—Ä–∫–µ—Ä–æ–≤. 0 - –∞–≤—Ç–æ (–ø—Ä–∏–º–µ—Ä–Ω–æ 4x –æ—Ç CPU, –º–∏–Ω–∏–º—É–º 32) | `--threads 200`                      |
| `--timeout`             | –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Ç–∞–π–º–∞—É—Ç —Å–∫–∞–Ω–∞                                   | `--timeout 10m`                      |
| `--fail-fast`           | –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –æ—à–∏–±–∫–µ                       | `--fail-fast`                        |
| `--save-full`           | –°–æ—Ö—Ä–∞–Ω—è—Ç—å —Ü–µ–ª–∏–∫–æ–º —Ñ–∞–π–ª –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —Å–æ–≤–ø–∞–¥–µ–Ω–∏–∏               | `--save-full`                        |
| `--save-full-folder`    | –ü–∞–ø–∫–∞ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –ø—Ä–∏ `--save-full`             | `--save-full-folder ./found_files`   |
| `--save-matches-file`   | –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ –≤ –æ–¥–∏–Ω —Ñ–∞–π–ª                 | `--save-matches-file all.txt`        |
| `--save-matches-folder` | –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞–π–¥–µ–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ –ø–æ —Ñ–∞–π–ª–∞–º –Ω–∞ –∫–∞–∂–¥—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω     | `--save-matches-folder ./by_pattern` |
| `--logfile`             | –ü–∏—Å–∞—Ç—å –ª–æ–≥–∏ –≤ —Ñ–∞–π–ª                                         | `--logfile finder.log`               |
| `--log-level`           | –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–æ–≤: debug, info, warn, error                    | `--log-level debug`                  |

* –ï—Å–ª–∏ –∑–∞–¥–∞–Ω `--whitelist`, —Ç–æ `--blacklist` –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è - whitelist –≥–ª–∞–≤–Ω–µ–µ.
* –ü—É—Ç—å(–∏) –¥–ª—è —Å–∫–∞–Ω–∞ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω–∏–º–∏ –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏. –ï—Å–ª–∏ –Ω–µ –ø–µ—Ä–µ–¥–∞—Ç—å - –∞–≤—Ç–æ-–¥–µ—Ç–µ–∫—Ç –≤—Å–µ—Ö –∫–æ—Ä–Ω–µ–π –û–°.

---

## üéØ –§–æ—Ä–º–∞—Ç –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤

–ö–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ –≤ `patterns.txt` - –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω:

```
# –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–æ–ø—É—Å–∫–∞—é—Ç—Å—è
re:^id=\d{3}$      # Go-regex, –ø—Ä–µ—Ñ–∏–∫—Å re:
plain:foo          # plain-—Å—Ç—Ä–æ–∫–∞, —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞—è –∫ —Ä–µ–≥–∏—Å—Ç—Ä—É (–ø—Ä–µ—Ñ–∏–∫—Å plain: –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω)
plain:i:Token      # plain-—Å—Ç—Ä–æ–∫–∞, —Ä–µ–≥–∏—Å—Ç—Ä –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è
```

–ö–æ—Ä–æ—Ç–∫–æ:

* `re:` - –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ regexp –≤ Go
* `plain:` - –ø–æ–¥—Å—Ç—Ä–æ–∫–∞, —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞—è –∫ —Ä–µ–≥–∏—Å—Ç—Ä—É
* `plain:i:` - –ø–æ–¥—Å—Ç—Ä–æ–∫–∞ –±–µ–∑ —É—á—ë—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞

---

## üìù –ü—Ä–∏–º–µ—Ä—ã

–ü–æ–∏—Å–∫ –ø–æ –≤—Å–µ–º –¥–∏—Å–∫–∞–º —Å –∞–≤—Ç–æ–¥–µ—Ç–µ–∫—Ç–æ–º:

```bash
./filefinder --pattern-file patterns.txt
```

–û–≥—Ä–∞–Ω–∏—á–∏—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è–º–∏ –∏ –≥–ª—É–±–∏–Ω–æ–π:

```bash
./filefinder --pattern-file patterns.txt --whitelist txt,md,log --depth 2 /home/user/Documents
```

–ê—Ä—Ö–∏–≤—ã + fail-fast:

```bash
./filefinder --pattern-file patterns.txt --archives --fail-fast /var/data
```

–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ –≤ –æ–¥–∏–Ω —Ñ–∞–π–ª:

```bash
./filefinder --pattern-file patterns.txt --save-matches-file ./matches.txt /var/log
```

–°–æ—Ö—Ä–∞–Ω—è—Ç—å –ø–æ–ª–Ω—ã–µ —Ñ–∞–π–ª—ã —Å —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è–º–∏:

```bash
./filefinder --pattern-file patterns.txt --save-full --save-full-folder ./found /etc /var/log
```

---

## üß™ –¢–µ—Å—Ç—ã

```bash
go test -v ./...
```

---

## ‚öôÔ∏è Makefile

–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —É–¥–æ–±–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π:

```bash
make build     # —Å–æ–±—Ä–∞—Ç—å ./bin/filefinder
make run       # —Å–æ–±—Ä–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–º–∏ —Ñ–ª–∞–≥–∞–º–∏
make test      # –ø—Ä–æ–≥–Ω–∞—Ç—å —Ç–µ—Å—Ç—ã
make clean     # –æ—á–∏—Å—Ç–∏—Ç—å bin
```

`Makefile` —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ `./cmd/main.go` –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `patterns.txt` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.

---

## üê≥ Docker

Dockerfile –Ω–∞ –±–∞–∑–µ distroless\:nonroot. –ü—Ä–∏–º–µ—Ä —Å–±–æ—Ä–∫–∏ –∏ –∑–∞–ø—É—Å–∫–∞:

```bash
# build
docker build -t filefinder:latest .

# run - —Å–∫–∞–Ω–∏—Ä—É–µ–º ./data, –ø–∞—Ç—Ç–µ—Ä–Ω—ã –∏–∑ ./patterns.txt, –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –ø–æ–ª–Ω—ã–µ —Ñ–∞–π–ª—ã –∫–ª–∞–¥—ë–º –≤ ./found_files
docker run --rm \
  -v "$PWD/data:/scan" \
  -v "$PWD/patterns.txt:/patterns.txt" \
  -v "$PWD/found_files:/found_files" \
  filefinder:latest \
  --pattern-file /patterns.txt \
  --threads 100 \
  --archives \
  /scan
```

* –í distro-less –Ω–µ—Ç —à–µ–ª–ª–∞ - –ø–∞–ø–∫–∞ `/found_files` —Å–æ–∑–¥–∞—ë—Ç—Å—è —á–µ—Ä–µ–∑ `WORKDIR` –≤ Dockerfile.
* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–æ–¥ nonroot.

---

## ‚ö†Ô∏è –ê–Ω—Ç–∏ zip-–±–æ–º–±–∞

–í–Ω—É—Ç—Ä–∏ –∞—Ä—Ö–∏–≤–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –º–∞–∫—Å–∏–º—É–º 10000 —Ñ–∞–π–ª–æ–≤ - –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –∞—Ä—Ö–∏–≤ —Å–∫–∏–ø–∞–µ—Ç—Å—è. –≠—Ç–æ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç zip-–±–æ–º–±.

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
cmd/
  main.go
internal/
  logger.go
  options.go
  matcher.go
  fs.go
  reader.go
  scanner.go
```
